<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>D3 test</title>
</head>

<body>
    <div class="container">
        <div id="graph"></div>
    </div>
</body>

</html>
<script src="https://d3js.org/d3.v4.min.js"></script>

<script>

    var nodes = [
        {
            "id": "Myriel"
        },
        {
            "id": "Napoleon"
        },
        {
            "id": "Mlle.Baptistine"
        },
        {
            "id": "Mme.Magloire"
        },
        {
            "id": "CountessdeLo"
        },
        {
            "id": "Geborand"
        },
        {
            "id": "Champtercier"
        },
        {
            "id": "Cravatte"
        },
        {
            "id": "Count"
        },
        {
            "id": "OldMan"
        },
        {
            "id": "Labarre"
        },
        {
            "id": "Valjean"
        },
        {
            "id": "Marguerite"
        },
        {
            "id": "Mme.deR"
        },
        {
            "id": "Isabeau"
        },
        {
            "id": "Gervais"
        },
        {
            "id": "Tholomyes"
        },
        {
            "id": "Listolier"
        },
        {
            "id": "Fameuil"
        },
        {
            "id": "Blacheville"
        },
        {
            "id": "Favourite"
        },
        {
            "id": "Dahlia"
        },
        {
            "id": "Zephine"
        },
        {
            "id": "Fantine"
        },
        {
            "id": "Mme.Thenardier"
        },
        {
            "id": "Thenardier"
        },
        {
            "id": "Cosette"
        },
        {
            "id": "Javert"
        },
        {
            "id": "Fauchelevent"
        },
        {
            "id": "Bamatabois"
        },
        {
            "id": "Perpetue"
        },
        {
            "id": "Simplice"
        },
        {
            "id": "Scaufflaire"
        },
        {
            "id": "Woman1"
        },
        {
            "id": "Judge"
        },
        {
            "id": "Champmathieu"
        },
        {
            "id": "Brevet"
        },
        {
            "id": "Chenildieu"
        },
        {
            "id": "Cochepaille"
        },
        {
            "id": "Pontmercy"
        },
        {
            "id": "Boulatruelle"
        },
        {
            "id": "Eponine"
        },
        {
            "id": "Anzelma"
        },
        {
            "id": "Woman2"
        },
        {
            "id": "MotherInnocent"
        },
        {
            "id": "Gribier"
        },
        {
            "id": "Jondrette"
        },
        {
            "id": "Mme.Burgon"
        },
        {
            "id": "Gavroche"
        },
        {
            "id": "Gillenormand"
        },
        {
            "id": "Magnon"
        },
        {
            "id": "Mlle.Gillenormand"
        },
        {
            "id": "Mme.Pontmercy"
        },
        {
            "id": "Mlle.Vaubois"
        },
        {
            "id": "Lt.Gillenormand"
        },
        {
            "id": "Marius"
        },
        {
            "id": "BaronessT"
        },
        {
            "id": "Mabeuf"
        },
        {
            "id": "Enjolras"
        },
        {
            "id": "Combeferre"
        },
        {
            "id": "Prouvaire"
        },
        {
            "id": "Feuilly"
        },
        {
            "id": "Courfeyrac"
        },
        {
            "id": "Bahorel"
        },
        {
            "id": "Bossuet"
        },
        {
            "id": "Joly"
        },
        {
            "id": "Grantaire"
        },
        {
            "id": "MotherPlutarch"
        },
        {
            "id": "Gueulemer"
        },
        {
            "id": "Babet"
        },
        {
            "id": "Claquesous"
        },
        {
            "id": "Montparnasse"
        },
        {
            "id": "Toussaint"
        },
        {
            "id": "Child1"
        },
        {
            "id": "Child2"
        },
        {
            "id": "Brujon"
        },
        {
            "id": "Mme.Hucheloup"
        }
    ];

    var links = [
        {
            "source": 1,
            "target": 0
        },
        {
            "source": 2,
            "target": 0
        },
        {
            "source": 3,
            "target": 0
        },
        {
            "source": 3,
            "target": 2
        },
        {
            "source": 4,
            "target": 0
        },
        {
            "source": 5,
            "target": 0
        },
        {
            "source": 6,
            "target": 0
        },
        {
            "source": 7,
            "target": 0
        },
        {
            "source": 8,
            "target": 0
        },
        {
            "source": 9,
            "target": 0
        },
        {
            "source": 11,
            "target": 10
        },
        {
            "source": 11,
            "target": 3
        },
        {
            "source": 11,
            "target": 2
        },
        {
            "source": 11,
            "target": 0
        },
        {
            "source": 12,
            "target": 11
        },
        {
            "source": 13,
            "target": 11
        },
        {
            "source": 14,
            "target": 11
        },
        {
            "source": 15,
            "target": 11
        },
        {
            "source": 17,
            "target": 16
        },
        {
            "source": 18,
            "target": 16
        },
        {
            "source": 18,
            "target": 17
        },
        {
            "source": 19,
            "target": 16
        },
        {
            "source": 19,
            "target": 17
        },
        {
            "source": 19,
            "target": 18
        },
        {
            "source": 20,
            "target": 16
        },
        {
            "source": 20,
            "target": 17
        },
        {
            "source": 20,
            "target": 18
        },
        {
            "source": 20,
            "target": 19
        },
        {
            "source": 21,
            "target": 16
        },
        {
            "source": 21,
            "target": 17
        },
        {
            "source": 21,
            "target": 18
        },
        {
            "source": 21,
            "target": 19
        },
        {
            "source": 21,
            "target": 20
        },
        {
            "source": 22,
            "target": 16
        },
        {
            "source": 22,
            "target": 17
        },
        {
            "source": 22,
            "target": 18
        },
        {
            "source": 22,
            "target": 19
        },
        {
            "source": 22,
            "target": 20
        },
        {
            "source": 22,
            "target": 21
        },
        {
            "source": 23,
            "target": 16
        },
        {
            "source": 23,
            "target": 17
        },
        {
            "source": 23,
            "target": 18
        },
        {
            "source": 23,
            "target": 19
        },
        {
            "source": 23,
            "target": 20
        },
        {
            "source": 23,
            "target": 21
        },
        {
            "source": 23,
            "target": 22
        },
        {
            "source": 23,
            "target": 12
        },
        {
            "source": 23,
            "target": 11
        },
        {
            "source": 24,
            "target": 23
        },
        {
            "source": 24,
            "target": 11
        },
        {
            "source": 25,
            "target": 24
        },
        {
            "source": 25,
            "target": 23
        },
        {
            "source": 25,
            "target": 11
        },
        {
            "source": 26,
            "target": 24
        },
        {
            "source": 26,
            "target": 11
        },
        {
            "source": 26,
            "target": 16
        },
        {
            "source": 26,
            "target": 25
        },
        {
            "source": 27,
            "target": 11
        },
        {
            "source": 27,
            "target": 23
        },
        {
            "source": 27,
            "target": 25
        },
        {
            "source": 27,
            "target": 24
        },
        {
            "source": 27,
            "target": 26
        },
        {
            "source": 28,
            "target": 11
        },
        {
            "source": 28,
            "target": 27
        },
        {
            "source": 29,
            "target": 23
        },
        {
            "source": 29,
            "target": 27
        },
        {
            "source": 29,
            "target": 11
        },
        {
            "source": 30,
            "target": 23
        },
        {
            "source": 31,
            "target": 30
        },
        {
            "source": 31,
            "target": 11
        },
        {
            "source": 31,
            "target": 23
        },
        {
            "source": 31,
            "target": 27
        },
        {
            "source": 32,
            "target": 11
        },
        {
            "source": 33,
            "target": 11
        },
        {
            "source": 33,
            "target": 27
        },
        {
            "source": 34,
            "target": 11
        },
        {
            "source": 34,
            "target": 29
        },
        {
            "source": 35,
            "target": 11
        },
        {
            "source": 35,
            "target": 34
        },
        {
            "source": 35,
            "target": 29
        },
        {
            "source": 36,
            "target": 34
        },
        {
            "source": 36,
            "target": 35
        },
        {
            "source": 36,
            "target": 11
        },
        {
            "source": 36,
            "target": 29
        },
        {
            "source": 37,
            "target": 34
        },
        {
            "source": 37,
            "target": 35
        },
        {
            "source": 37,
            "target": 36
        },
        {
            "source": 37,
            "target": 11
        },
        {
            "source": 37,
            "target": 29
        },
        {
            "source": 38,
            "target": 34
        },
        {
            "source": 38,
            "target": 35
        },
        {
            "source": 38,
            "target": 36
        },
        {
            "source": 38,
            "target": 37
        },
        {
            "source": 38,
            "target": 11
        },
        {
            "source": 38,
            "target": 29
        },
        {
            "source": 39,
            "target": 25
        },
        {
            "source": 40,
            "target": 25
        },
        {
            "source": 41,
            "target": 24
        },
        {
            "source": 41,
            "target": 25
        },
        {
            "source": 42,
            "target": 41
        },
        {
            "source": 42,
            "target": 25
        },
        {
            "source": 42,
            "target": 24
        },
        {
            "source": 43,
            "target": 11
        },
        {
            "source": 43,
            "target": 26
        },
        {
            "source": 43,
            "target": 27
        },
        {
            "source": 44,
            "target": 28
        },
        {
            "source": 44,
            "target": 11
        },
        {
            "source": 45,
            "target": 28
        },
        {
            "source": 47,
            "target": 46
        },
        {
            "source": 48,
            "target": 47
        },
        {
            "source": 48,
            "target": 25
        },
        {
            "source": 48,
            "target": 27
        },
        {
            "source": 48,
            "target": 11
        },
        {
            "source": 49,
            "target": 26
        },
        {
            "source": 49,
            "target": 11
        },
        {
            "source": 50,
            "target": 49
        },
        {
            "source": 50,
            "target": 24
        },
        {
            "source": 51,
            "target": 49
        },
        {
            "source": 51,
            "target": 26
        },
        {
            "source": 51,
            "target": 11
        },
        {
            "source": 52,
            "target": 51
        },
        {
            "source": 52,
            "target": 39
        },
        {
            "source": 53,
            "target": 51
        },
        {
            "source": 54,
            "target": 51
        },
        {
            "source": 54,
            "target": 49
        },
        {
            "source": 54,
            "target": 26
        },
        {
            "source": 55,
            "target": 51
        },
        {
            "source": 55,
            "target": 49
        },
        {
            "source": 55,
            "target": 39
        },
        {
            "source": 55,
            "target": 54
        },
        {
            "source": 55,
            "target": 26
        },
        {
            "source": 55,
            "target": 11
        },
        {
            "source": 55,
            "target": 16
        },
        {
            "source": 55,
            "target": 25
        },
        {
            "source": 55,
            "target": 41
        },
        {
            "source": 55,
            "target": 48
        },
        {
            "source": 56,
            "target": 49
        },
        {
            "source": 56,
            "target": 55
        },
        {
            "source": 57,
            "target": 55
        },
        {
            "source": 57,
            "target": 41
        },
        {
            "source": 57,
            "target": 48
        },
        {
            "source": 58,
            "target": 55
        },
        {
            "source": 58,
            "target": 48
        },
        {
            "source": 58,
            "target": 27
        },
        {
            "source": 58,
            "target": 57
        },
        {
            "source": 58,
            "target": 11
        },
        {
            "source": 59,
            "target": 58
        },
        {
            "source": 59,
            "target": 55
        },
        {
            "source": 59,
            "target": 48
        },
        {
            "source": 59,
            "target": 57
        },
        {
            "source": 60,
            "target": 48
        },
        {
            "source": 60,
            "target": 58
        },
        {
            "source": 60,
            "target": 59
        },
        {
            "source": 61,
            "target": 48
        },
        {
            "source": 61,
            "target": 58
        },
        {
            "source": 61,
            "target": 60
        },
        {
            "source": 61,
            "target": 59
        },
        {
            "source": 61,
            "target": 57
        },
        {
            "source": 61,
            "target": 55
        },
        {
            "source": 62,
            "target": 55
        },
        {
            "source": 62,
            "target": 58
        },
        {
            "source": 62,
            "target": 59
        },
        {
            "source": 62,
            "target": 48
        },
        {
            "source": 62,
            "target": 57
        },
        {
            "source": 62,
            "target": 41
        },
        {
            "source": 62,
            "target": 61
        },
        {
            "source": 62,
            "target": 60
        },
        {
            "source": 63,
            "target": 59
        },
        {
            "source": 63,
            "target": 48
        },
        {
            "source": 63,
            "target": 62
        },
        {
            "source": 63,
            "target": 57
        },
        {
            "source": 63,
            "target": 58
        },
        {
            "source": 63,
            "target": 61
        },
        {
            "source": 63,
            "target": 60
        },
        {
            "source": 63,
            "target": 55
        },
        {
            "source": 64,
            "target": 55
        },
        {
            "source": 64,
            "target": 62
        },
        {
            "source": 64,
            "target": 48
        },
        {
            "source": 64,
            "target": 63
        },
        {
            "source": 64,
            "target": 58
        },
        {
            "source": 64,
            "target": 61
        },
        {
            "source": 64,
            "target": 60
        },
        {
            "source": 64,
            "target": 59
        },
        {
            "source": 64,
            "target": 57
        },
        {
            "source": 64,
            "target": 11
        },
        {
            "source": 65,
            "target": 63
        },
        {
            "source": 65,
            "target": 64
        },
        {
            "source": 65,
            "target": 48
        },
        {
            "source": 65,
            "target": 62
        },
        {
            "source": 65,
            "target": 58
        },
        {
            "source": 65,
            "target": 61
        },
        {
            "source": 65,
            "target": 60
        },
        {
            "source": 65,
            "target": 59
        },
        {
            "source": 65,
            "target": 57
        },
        {
            "source": 65,
            "target": 55
        },
        {
            "source": 66,
            "target": 64
        },
        {
            "source": 66,
            "target": 58
        },
        {
            "source": 66,
            "target": 59
        },
        {
            "source": 66,
            "target": 62
        },
        {
            "source": 66,
            "target": 65
        },
        {
            "source": 66,
            "target": 48
        },
        {
            "source": 66,
            "target": 63
        },
        {
            "source": 66,
            "target": 61
        },
        {
            "source": 66,
            "target": 60
        },
        {
            "source": 67,
            "target": 57
        },
        {
            "source": 68,
            "target": 25
        },
        {
            "source": 68,
            "target": 11
        },
        {
            "source": 68,
            "target": 24
        },
        {
            "source": 68,
            "target": 27
        },
        {
            "source": 68,
            "target": 48
        },
        {
            "source": 68,
            "target": 41
        },
        {
            "source": 69,
            "target": 25
        },
        {
            "source": 69,
            "target": 68
        },
        {
            "source": 69,
            "target": 11
        },
        {
            "source": 69,
            "target": 24
        },
        {
            "source": 69,
            "target": 27
        },
        {
            "source": 69,
            "target": 48
        },
        {
            "source": 69,
            "target": 41
        },
        {
            "source": 70,
            "target": 25
        },
        {
            "source": 70,
            "target": 69
        },
        {
            "source": 70,
            "target": 68
        },
        {
            "source": 70,
            "target": 11
        },
        {
            "source": 70,
            "target": 24
        },
        {
            "source": 70,
            "target": 27
        },
        {
            "source": 70,
            "target": 41
        },
        {
            "source": 70,
            "target": 58
        },
        {
            "source": 71,
            "target": 27
        },
        {
            "source": 71,
            "target": 69
        },
        {
            "source": 71,
            "target": 68
        },
        {
            "source": 71,
            "target": 70
        },
        {
            "source": 71,
            "target": 11
        },
        {
            "source": 71,
            "target": 48
        },
        {
            "source": 71,
            "target": 41
        },
        {
            "source": 71,
            "target": 25
        },
        {
            "source": 72,
            "target": 26
        },
        {
            "source": 72,
            "target": 27
        },
        {
            "source": 72,
            "target": 11
        },
        {
            "source": 73,
            "target": 48
        },
        {
            "source": 74,
            "target": 48
        },
        {
            "source": 74,
            "target": 73
        },
        {
            "source": 75,
            "target": 69
        },
        {
            "source": 75,
            "target": 68
        },
        {
            "source": 75,
            "target": 25
        },
        {
            "source": 75,
            "target": 48
        },
        {
            "source": 75,
            "target": 41
        },
        {
            "source": 75,
            "target": 70
        },
        {
            "source": 75,
            "target": 71
        },
        {
            "source": 76,
            "target": 64
        },
        {
            "source": 76,
            "target": 65
        },
        {
            "source": 76,
            "target": 66
        },
        {
            "source": 76,
            "target": 63
        },
        {
            "source": 76,
            "target": 62
        },
        {
            "source": 76,
            "target": 48
        },
        {
            "source": 76,
            "target": 58
        }
    ];

    var width = 1920;
    var height = 1080;
    var svg = d3.select("#graph")
        .append("svg")
        .attr("width", width)
        .attr("height", height)
        .call(d3.zoom() //创建缩放行为
            .scaleExtent([-5, 2])
            .on('zoom',zoom_actions)); //设置缩放范围
        
    //初始化力学仿真器，通过布局函数格式化数据    
    var simulation = d3.forceSimulation(nodes)
        .force("link", d3.forceLink(links).distance(100))   //distance设置连线距离
        .force("charge", d3.forceManyBody().strength(-100))  //注1> 
        .force("center", d3.forceCenter(width / 2, height / 2))  //设置力学仿真器的中心
        .on("tick", ticked);  
	
	//布局函数格式化后的数据，注2>
	console.log('nodes', nodes);
    console.log('links', links);  
    
    var color = d3.scaleOrdinal(d3.schemeCategory20);  //生成颜色选择器函数，此函数返回颜色数组 (string [])
    
     //添加group包裹svg元素以进行缩放，目的是在缩放时不会影响整个容器的位置
    var g = svg.append("g")
    .attr("class", "everything");

    // 绘制连线
    var svg_links = g.append('g')
        .selectAll("line")
        .data(links)
        .enter()
        .append("line")
        .style("stroke", "#ccc")
        .style("stroke-width", 3)
        

    // 绘制节点    
    var svg_nodes = g.append('g')
        .selectAll("circle")
        .data(nodes)
        .enter()
        .append("circle")
        .attr("r", '10')
        .style("fill", function (d, i) {
            return color(i);
        }).call(d3.drag().on("start", dragstarted) //d3.drag() 创建一个拖曳行为
          .on("drag", dragged)
          .on("end", dragended));
   
    //绘制描述节点的文字
    var svg_texts =  g.append('g')
        .selectAll("text")
        .data(nodes)
        .enter()
        .append("text")
        .style("fill", "black")
        .attr("dx", 20)
        .attr("dy", 8)
        .text(function (d) {
            return d.name;
        });

    //监听拖拽开始    
    function dragstarted(d) {
        if (!d3.event.active) simulation.alphaTarget(0.3).restart(); //alpha是动画的冷却系数，运动过程中会不断减小，直到小于0.005为止，此时动画会停止。
        d.fx = d.x;    //fx为固定坐标，x为初始坐标  注3>  
        d.fy = d.y;
    }

    //监听拖拽中  
    function dragged(d) {
        d.fx = d3.event.x;  //fevent.x为拖拽移动时的坐标
        d.fy = d3.event.y;
    }

    //监听拖拽结束
    function dragended(d) {
        if (!d3.event.active) simulation.alphaTarget(0);
        d.fx = null;        //固定坐标清空
        d.fy = null;
    }

    function zoom_actions() { 
        g.attr("transform", d3.event.transform)
     }

    //拖拽时的事件监听器  以实时更新坐标
    function ticked() {
        svg_links.attr("x1", function (d) {
                return d.source.x;
            })
            .attr("y1", function (d) {
                return d.source.y;
            })
            .attr("x2", function (d) {
                return d.target.x;
            })
            .attr("y2", function (d) {
                return d.target.y;
            });

        svg_nodes.attr("cx", function (d) {
                return d.x;
            })
            .attr("cy", function (d) {
                return d.y;
            });

        svg_texts.attr("x", function (d) {
                return d.x;
            })
            .attr("y", function (d) {
                return d.y;
            });
    }

</script>